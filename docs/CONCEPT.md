# Puricale (プリカレ) - Final Specification

> **Version:** 9.1 (Implementation Ready)
> **Last Updated:** 2026/02/12
> **Status:** **Confirmed for Development**

---

## 1. コンセプト (Concept)

### コアメッセージ (Core Message)
**「未来の自分を助けるアプリ」**
〜去年の自分が、今年のあなたを助ける〜

### ユーザーへの約束 (Promise)
* **「明日の準備が30秒で終わる」**: 迷わない、探さない。
* **「正解の復元」**: 忘れてしまった「去年の持ち物リスト」や「お弁当のメモ」を、必要な瞬間に手渡す。

### 開発チームのミッション
**「Family Knowledge OS v1」**
複雑な構造化はv2以降。まずは「正規化されたタグ」による検索と「イベント連動」による再利用を実現し、家族の記憶インフラとなる。

## 2. 課題定義 (The Problem)

### 真の課題 (Deep Pain)
* **"今"の徒労感**: 毎年同じ「運動会」があるのに、毎回ゼロから「レジャーシートの大きさは？」「お弁当の量は？」と悩み、同じミスを繰り返す。
* **資産の消失**: 苦労して乗り切った行事の記憶が、喉元過ぎれば忘れ去られ、積み上がらない。
* **人質への恐怖**: 便利なツールを使いたいが、解約したらデータが消える恐怖で導入に踏み切れない。

## 3. ソリューション構造 (Architecture)

### Layer 1: Input (Inbox)
* **「思考停止でOK」**: 予定表、献立、しおり、学年だより。分類不要でLINEに投げるだけ。
* **Ask Before Run:** 誤爆防止。ボタンタップでAI解析開始。
* **Security:** 画像はサーバー側で即時圧縮・暗号化し、ファイル名はUUID化。

### Layer 2: Knowledge v1 (Tag Normalization) 👈 Critical
* **2-Layer Tagging (Canonical ID + Alias):**
    * AIの出力（揺らぎ）をそのまま使わず、内部辞書で強制統一する。
    * **Layer A (ID):** `EVENT_SPORTS_DAY`
    * **Layer B (Alias):** `体育祭` `スポーツ大会` `運動会` → `EVENT_SPORTS_DAY`
* **User Feedback Loop:**
    * ユーザーによるタグ修正ログを蓄積し、辞書（Alias）を継続的に改善する。

### Layer 3: Output (Context-Aware)
* **Flow (Google Calendar):** 未来の予定管理。「日時」と「要約」のみを登録。
* **Stock (Restore UI):**
    * **Event-Trigger Notification:** 新しい予定（例: 今年の運動会）を登録した瞬間、過去の正規化タグ（`#運動会`）を検索。
        * **Noise Reduction:** 過去データが複数ある場合、「最も新しい1件」のみを通知対象とする。
    * **Specific Message:** 「去年の記録があります」ではなく、**「去年の【持ち物リスト】が見つかりました」**と具体的に通知する。

## 4. マネタイズ (Value & Business)
**「制限」ではなく「復元権」を販売する。**

| プラン | スタンダード (Free) | プレミアム (Pro) |
| :--- | :--- | :--- |
| **コンセプト** | **「便利なプリント管理」** | **「家族の記憶インフラ」** |
| **データ保存** | **無制限** (全期間保存) | **無制限** (全期間保存) |
| **今のイベント** | **閲覧・検索 OK**<br>(直近3ヶ月以内のデータ) | **閲覧・検索 OK** |
| **過去のイベント** | **Memory Locked 🔒**<br>「去年の `#運動会` の【持ち物リスト】があります」と表示されるが、詳細は閲覧不可。<br>★ **初回限定: 「復元チケット」1枚配布** (感動体験の提供) | **Restore Memory 🗝️**<br>鍵を解除し、去年のしおり・メモ・画像を全て復元。**「再利用」**できる。<br>★ **Unlock演出:** 鍵が開くアニメーションと共にチェックリストが生成される。 |
| **データ出力** | **Zip/JSON エクスポート機能** (信頼担保のため無料開放) | (同左) |
| **価格** | ¥0 | **月額 ¥300〜¥500** |

## 5. 指標設計 (KPIs)

### North Star Metric
🌟 **Future Saved Time (未来の節約時間)**
* 定義: 推定ではなく、アクションごとの**「固定値積み上げ」**で算出する（納得感重視）。
    * 検索ヒット = **+1分**
    * リスト閲覧 = **+3分**
    * Restore実行 = **+10分**
* UI表示: 「あなたは今年、合計 **2時間15分** を節約しました」

### Action KPIs
1.  **Tag Match Rate**: カレンダー登録時に、過去のタグがヒットした回数（＝再利用のチャンス）。
2.  **Restore Action**: 「去年の記録を見る（鍵解除）」ボタンが押された回数。
3.  **First Ticket Usage**: 無料ユーザーが最初の「復元チケット」を使用した率（＝価値実感）。

## 6. 技術的安全性 (Technical Safety Measures)

* **Stripe Robustness:** 決済状態（`active/canceled`）はStripeに依存せず、自社DBにキャッシュし、Webhook遅延による事故を防ぐ。
* **Tag Correction:** ユーザーが誤ったタグを修正できるUI（「タグ編集」ボタン）を必ず実装する。

## 7. ロードマップ (MVP Priorities)

### Phase 1-3: 基礎機能 (✅ Completed)
* OCR、フィルタリング、LINE Bot基盤の実装完了。

### Phase 4: 信頼基盤とアプリ化 (🏃 Running)
* **Current Task:** 奥様へのαリリースと実運用テスト。
* **Add:** データエクスポート機能の実装。

### Phase 5: ナレッジ化と資産化 (Implementation Priority) 👈 Next
* **MVP Scope (これ以外作らない):**
    1.  **タグ抽出 & 正規化:** 辞書マッピングの実装。
    2.  **イベント連動通知:** カレンダー登録フック → 過去タグ検索（最新1件）。
    3.  **Restore UI:** ロック画面、初回チケット、アニメーション演出。
    4.  **決済:** Stripe連携（キャッシュ機構含む）。

## 8. 開発マニフェスト (Development Philosophy)
1.  **Don't hold data hostage:** データはユーザーのもの。エクスポート機能は権利である。
2.  **Specific Triggers:** 「記録」ではなく「持ち物リスト」と言え。抽象度を下げるほどCVRは上がる。
3.  **Normalize or Die:** 表記揺れはシステムの死。AIを過信せず、辞書で管理せよ。